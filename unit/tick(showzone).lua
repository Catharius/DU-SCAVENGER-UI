local closest_scan_distance = -1
local time_of_scan = ""
local totalbm = 0

for _, key in ipairs(json.decode(databank.getKeys())) do
    totalbm = totalbm + 1
    local data = databank.getStringValue(key)
    data = split(data,"|")
    time_of_scan = data[1]
    scan_position = vec3({tonumber(data[2]),tonumber(data[3]),tonumber(data[4])})
    local distanceToScan = (scan_position - vec3(core.getConstructWorldPos())):len()
    if closest_scan_distance < 0 then
        closest_scan_distance = distanceToScan
    elseif  closest_scan_distance > distanceToScan then
        closest_scan_distance = distanceToScan
    end 
end

local text = "Closest bookmark : "..getDistanceDisplayString(closest_scan_distance)
local color = bookmark_notvisited_color
local state = "Area not visited yet.(Alt+1 to mark as visited) "
if closest_scan_distance<bookmark_visited_distance then
    color = bookmark_visited_color
    state = "Last visit : "..time_of_scan
end    


system.setScreen([[<svg style="position:absolute;top:0vh" viewBox="0 0 1920 1080" style="width:100%; height:100%"><g>>
  <text style="cursor: move;" xml:space="preserve" text-anchor="start" font-family="sans-serif" font-size="18" id="svg_2" y="122.25009" x="5.00011" stroke-opacity="null" stroke-width="0" stroke="#000" fill="#]]..color..[[">Scav UI v0.1</text>
  <text xml:space="preserve" text-anchor="start" font-family="sans-serif" font-size="15" id="svg_3" y="30.00008" x="109.50012" stroke-opacity="null" stroke-width="0" stroke="#000" fill="#]]..color..[[">Total nb of bookmarks : ]]..totalbm..[[</text>
  <text xml:space="preserve" text-anchor="start" font-family="sans-serif" font-size="30" id="svg_3" y="74.00008" x="109.50012" stroke-opacity="null" stroke-width="0" stroke="#000" fill="#]]..color..[[">]]..text..[[</text>
  <text xml:space="preserve" text-anchor="start" font-family="sans-serif" font-size="25" id="svg_31" y="104.00008" x="109.50012" stroke-opacity="null" stroke-width="0" stroke="#000" fill="#]]..color..[[">]]..state..[[</text>
  <path id="svg_4" d="m63.87639,31.38971c0,0 0,-2.11034 0.90933,-3.47647c0.52108,-0.77179 2.18521,-1.16405 2.18521,-1.16405c0,0 1.78706,-0.56741 3.95265,-0.44688c1.67775,0.09298 3.84712,0.87742 3.84712,0.87742c0,0 2.39706,0.05188 3.21972,1.11225c1.00438,1.3038 -0.58135,2.82458 -0.58135,2.82458c0,0 0.21037,0.88742 1.01943,1.63293c0.66656,0.61289 1.96351,1.12 1.96351,1.12c0,0 0.24581,0.15403 0.42982,0.44701c0.16286,0.26736 0.25785,0.68589 0.25785,0.68589c0,0 0.79929,0.50431 0.85435,1.12927c0.06106,0.66814 -0.6236,1.46193 -0.6236,1.46193c0,0 -0.31214,1.23497 -0.8792,2.12657c-0.3657,0.57884 -1.07452,0.94909 -1.07452,0.94909c0,0 -1.62417,1.1768 -3.60805,1.44855c-1.50053,0.20488 -3.50403,-0.47676 -3.50403,-0.47676c0,0 1.02928,2.77846 0.91316,5.60879c0.16447,4.44246 -3.76372,8.19254 -5.44414,13.19581c-0.59344,1.50738 -0.22772,3.25944 -0.22772,3.25944c0,0 -0.17041,4.39721 -0.79776,8.31269c-0.51126,3.21759 -1.493,6.09327 -1.493,6.09327c0,0 0.60081,1.73806 0.45469,2.85868c0.50923,0.28566 2.68789,1.53568 2.41066,2.53515c-0.41598,0.06305 -1.18612,-0.32348 -1.18612,-0.32348c0,0 -0.35286,0.35468 -0.78873,0.40863c-0.32043,0.04248 -0.6198,0.1029 -0.76008,-0.20723c-0.75099,0.15388 -2.08264,-0.41426 -2.08264,-0.41426c0,0 -1.02471,-0.70369 -1.50806,-1.45265c-0.26165,-0.40156 -0.67443,-0.02955 -0.13875,-1.08255c0.53571,-1.053 -0.05503,-1.26113 -0.05503,-1.26113c0,0 -1.19742,0.54046 -1.99518,0.50789c-0.39208,-0.01845 -0.68766,-0.62416 -0.68766,-0.62416c0,0 0.144,-1.26413 0.04899,-2.37205c-0.14023,-1.57616 -0.53838,-3.15796 -0.53838,-3.15796c0,0 -0.95911,-0.97189 -1.70712,-3.75748c-0.51728,-1.92294 -0.57231,-4.61919 -0.93426,-6.60461c-0.36195,-2.01947 -1.08891,-3.34639 -1.02925,-3.31547c-1.74317,2.09412 -3.92853,2.5912 -3.92853,2.5912c0,0 0.35667,3.18216 0.05657,5.77684c-0.28806,2.50183 -1.23135,4.41849 -1.23135,4.41849c0,0 -0.99717,2.30785 -1.29618,3.87025c-0.21282,1.11212 0.04249,1.3848 0.23677,1.66123c1.18458,1.3077 6.46619,-1.06735 7.72057,0.64264c0.12895,0.06813 0.4019,0.38868 0.71785,0.57026c0.33554,0.193 1.0006,1.1464 0.80003,1.2542c-0.16663,0.09363 -0.52481,-0.01278 -0.52481,-0.01278c0,0 0.09649,0.58304 -0.12517,0.79587c-0.23677,0.21703 -0.78873,0.06945 -0.78873,0.06945c0,0 -0.35968,-0.26953 -1.03453,-0.34608c-0.64243,-0.07238 -1.60685,0.04818 -1.60685,0.04818c0,0 -2.62036,-0.90152 -4.93291,0.59021c-1.21952,0.60206 -2.15125,0.60579 -3.38638,0.75044c-0.68766,0.08088 -0.99909,-0.42413 -0.99909,-0.42413c0,0 -0.22698,0.28516 -0.68164,0.53199c-0.51802,0.27521 -1.07074,0.68091 -1.07074,0.68091c0,0 0.25938,0.30226 0.67639,0.51639c0.26316,0.1306 0.76005,0.21288 0.76005,0.21288c0,0 1.91941,0.28156 3.73325,-0.26526c0.30087,-0.01703 2.49962,1.0994 2.78541,1.33773c0.21792,0.17878 -0.21243,0.73039 -0.5776,0.87392c-1.86499,1.04355 -3.18539,-0.49816 -6.17253,0.57179c-2.7566,0.31551 -3.89611,-0.03978 -4.81529,-0.66961c-0.61,-0.41713 -0.65978,-1.30808 -0.65978,-1.30808c0,0 -0.88298,-1.11655 -0.95309,-2.15502c-0.03018,-0.45818 1.16573,-2.08829 1.66566,-2.91961c0.4117,-0.67811 0.89505,-1.50803 0.89505,-1.50803c0,0 0.38606,-0.77174 0.64771,-1.75631c0.19529,-0.71511 0.23149,-1.55913 0.47204,-2.24437c0.28803,-0.83992 0.79926,-1.50376 0.79926,-1.50376c0,0 -1.38291,-1.03707 -2.44232,-2.3352c-1.31126,-1.61233 -2.34656,-3.54597 -2.34656,-3.54597c0,0 -3.41276,-2.38622 -5.9614,-5.25688c-1.61287,-1.81244 -2.81256,-4.61499 -2.81256,-4.61499c0,0 -0.59769,0.58844 -1.4455,1.33288c-6.02396,5.28956 -6.50612,16.04835 -8.40068,27.70668c-1.23238,7.58348 -4.1736,12.4242 -6.08208,13.99466c-1.7373,1.43143 -3.91721,1.50523 -3.91721,1.50523c0,0 -1.36255,0.02125 -1.51785,-0.24403c-0.14931,-0.24548 0.91538,-0.78317 0.91538,-0.78317c0,0 1.9539,-0.94682 3.17976,-2.44577c5.13329,-6.2768 5.65057,-24.47707 7.95016,-32.194c1.16211,-3.89985 2.72882,-14.33361 13.66126,-20.02825c7.94427,-4.13813 25.11449,-6.93061 29.41567,-12.09279c0.86415,-1.03715 1.80066,-2.10889 1.80066,-2.10889z" stroke-opacity="null" stroke-width="1.5" stroke="#000" fill="#]]..color..[["/>
 </g></svg>]])
